import{C as c,h as y,b as v,d as r,i as _,j as x,k as C}from"./three-003e6fb4.js";import{C as l,T as w}from"./ThreeInstance-b1b8b65a.js";import{d as I,b as p,z as M,A as P,o as z,f as S,g as u,m as L,q as T}from"./@vue-92cee4ac.js";import{_ as B}from"./index-0dc0f7b7.js";import"./gsap-89c74157.js";import"./vue-router-95ee3816.js";var F="float distanceTo(vec2 src,vec2 dst){float dx=src.x-dst.x;float dy=src.y-dst.y;float dv=dx*dx+dy*dy;return sqrt(dv);}varying vec3 vPosition;uniform float height;uniform vec3 uFlowColor;uniform vec3 uCityColor;void main(){vec3 distColor=uCityColor;float topY=vPosition.z+10.;if(height>vPosition.z&&height<topY){float dIndex=sin((height-vPosition.z)/10.0*3.14);distColor=mix(uFlowColor,distColor,1.0-dIndex);}vec2 position2D=vec2(vPosition.x,vPosition.y);float Len=distanceTo(position2D,vec2(0,0));if(Len>height*30.0&&Len<(height*30.0+130.0)){float dIndex=sin((Len-height*30.0)/130.0*3.14);distColor=mix(uFlowColor,distColor,1.0-dIndex);}gl_FragColor=vec4(distColor,1.0);}",D="varying vec3 vPosition;void main(){vPosition=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}";const k=i=>(L("data-v-712534d6"),i=i(),T(),i),b={style:{"box-sizing":"border-box"}},A=k(()=>u("div",{style:{position:"absolute",top:"20px",left:"20px",color:"aliceblue","font-size":"20px"}}," threejs路由切换时上一个场景会占用内存,重新刷新即可解决，此问题等待后续版本优化！ ",-1)),G=I({__name:"City",setup(i){const d=p(),t=p();l.camera.position={x:600,y:600,z:600},l.sources=[{name:"shanghai",type:"GLTF",show:!0,path:"/gltf/shanghai.gltf"}];const a={height:{value:20},uFlowColor:{value:new c("#5588aa")},uCityColor:{value:new c("#1B3045")}},m=new y({uniforms:a,vertexShader:D,fragmentShader:F,transparent:!0}),h=(e,s)=>{const o=new r(e.geometry,m);o.position.set(e.position.x,e.position.y,e.position.z),o.name="city",s.scene.add(o),o.rotateX(-Math.PI/2)},f=(e,s)=>{const o=new _(e.geometry,1),g=new x({color:"rgba(38,133,254)"}),n=new C(o,g);n.position.set(e.position.x,e.position.y,e.position.z),s.scene.add(n),n.rotateX(-Math.PI/2)};return M(()=>{t.value=new w(d.value,l),t.value.resources.on("ready",()=>{t.value.resources.items.shanghai.scene.traverse(e=>{if(e.isMesh)if(["CITY_UNTRIANGULATED"].includes(e.name))f(e,t.value),h(e,t.value);else if(["ROADS"].includes(e.name)){const s=new v({color:"rgb(41,46,76)"}),o=new r(e.geometry,s);o.rotateX(-Math.PI/2),o.position.set(e.position.x,e.position.y,e.position.z),t.value.scene.add(o)}else{const s=new v({color:"#040912"}),o=new r(e.geometry,s);t.value.scene.add(o),o.rotateX(-Math.PI/2),o.position.set(e.position.x,e.position.y,e.position.z)}})}),t.value.time.on("tick",()=>{a.height.value+=.2,a.height.value>100&&(a.height.value=0)})}),P(()=>{t.value.dispose()}),(e,s)=>(z(),S("div",b,[A,u("canvas",{class:"webgl",ref_key:"canvasDom",ref:d},null,512)]))}});const q=B(G,[["__scopeId","data-v-712534d6"]]);export{q as default};
