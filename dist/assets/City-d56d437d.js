import{C as c,S as p,a as d,b as l,E as u,L as f,c as m}from"./three-91beb2f7.js";import{A as g,k as h}from"./three-auto-4bac729d.js";import{d as y,b as v,A as _,B as C,o as x,f as w,g as M}from"./@vue-8a7444cd.js";import{_ as P}from"./index-6d8d8090.js";import"./vue-router-eb2f494d.js";var I="float distanceTo(vec2 src,vec2 dst){float dx=src.x-dst.x;float dy=src.y-dst.y;float dv=dx*dx+dy*dy;return sqrt(dv);}varying vec3 vPosition;uniform float height;uniform vec3 uFlowColor;uniform vec3 uCityColor;void main(){vec3 distColor=uCityColor;float topY=vPosition.z+10.;if(height>vPosition.z&&height<topY){float dIndex=sin((height-vPosition.z)/10.0*3.14);distColor=mix(uFlowColor,distColor,1.0-dIndex);}vec2 position2D=vec2(vPosition.x,vPosition.y);float Len=distanceTo(position2D,vec2(0,0));if(Len>height*30.0&&Len<(height*30.0+130.0)){float dIndex=sin((Len-height*30.0)/130.0*3.14);distColor=mix(uFlowColor,distColor,1.0-dIndex);}gl_FragColor=vec4(distColor,1.0);}",L="varying vec3 vPosition;void main(){vPosition=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}";const a={height:{value:20},uFlowColor:{value:new c("#5588aa")},uCityColor:{value:new c("#1B3045")}},z=new p({uniforms:a,vertexShader:L,fragmentShader:I,transparent:!0}),S=(t,n)=>{const e=new l(t.geometry,z);e.position.set(t.position.x,t.position.y,t.position.z),e.name="city",n.scene.add(e),e.rotateX(-Math.PI/2)},B=(t,n)=>{const e=new u(t.geometry,1),s=new f({color:"rgba(38,133,254)"}),o=new m(e,s);o.position.set(t.position.x,t.position.y,t.position.z),n.scene.add(o),o.rotateX(-Math.PI/2)},A=t=>{const n={camera:{fov:60,near:1,far:1e4,position:{x:0,y:70,z:-300},controls:{enable:!0,enableDamping:!0,enablePan:!0}},renderer:{clearAlpha:1,clearColor:"#302E37"}},e=new g(t,n),s=new h([{name:"shanghai",type:"GLTF",show:!0,path:"/gltf/shanghai.gltf"}],"circle");return s.on("ready",()=>{s.items.get("shanghai").scene.traverse(o=>{if(o.isMesh)if(["CITY_UNTRIANGULATED"].includes(o.name)){if(!e)return;B(o,e),S(o,e)}else if(["ROADS"].includes(o.name)){const r=new d({color:"rgb(41,46,76)"}),i=new l(o.geometry,r);if(i.rotateX(-Math.PI/2),i.position.set(o.position.x,o.position.y,o.position.z),!e)return;e.scene.add(i)}else{const r=new d({color:"#040912"}),i=new l(o.geometry,r);if(!e)return;e.scene.add(i),i.rotateX(-Math.PI/2),i.position.set(o.position.x,o.position.y,o.position.z)}})}),e.time.on("tick",()=>{a.height.value+=.2,a.height.value>100&&(a.height.value=0)}),e},D={style:{"box-sizing":"border-box"}},T=y({__name:"City",setup(t){const n=v(),e=v();return _(()=>{e.value=A(n.value)}),C(()=>{e.value&&e.value.dispose()}),(s,o)=>(x(),w("div",D,[M("canvas",{class:"webgl",ref_key:"canvasDom",ref:n},null,512)]))}});const G=P(T,[["__scopeId","data-v-e74cf21c"]]);export{G as default};
