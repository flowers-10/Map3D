import{C as c,S as u,M as d,a as l,E as f,L as m,b as h}from"./three-babea55e.js";import{T as g,c as y}from"./three-auto-9bdffedf.js";import{d as _,b as p,z as x,A as C,o as w,f as M,g as v,m as I,q as P}from"./@vue-92cee4ac.js";import{_ as S}from"./index-801a2013.js";import"./vue-router-95ee3816.js";var z="float distanceTo(vec2 src,vec2 dst){float dx=src.x-dst.x;float dy=src.y-dst.y;float dv=dx*dx+dy*dy;return sqrt(dv);}varying vec3 vPosition;uniform float height;uniform vec3 uFlowColor;uniform vec3 uCityColor;void main(){vec3 distColor=uCityColor;float topY=vPosition.z+10.;if(height>vPosition.z&&height<topY){float dIndex=sin((height-vPosition.z)/10.0*3.14);distColor=mix(uFlowColor,distColor,1.0-dIndex);}vec2 position2D=vec2(vPosition.x,vPosition.y);float Len=distanceTo(position2D,vec2(0,0));if(Len>height*30.0&&Len<(height*30.0+130.0)){float dIndex=sin((Len-height*30.0)/130.0*3.14);distColor=mix(uFlowColor,distColor,1.0-dIndex);}gl_FragColor=vec4(distColor,1.0);}",L="varying vec3 vPosition;void main(){vPosition=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}";const a={height:{value:20},uFlowColor:{value:new c("#5588aa")},uCityColor:{value:new c("#1B3045")}},T=new u({uniforms:a,vertexShader:L,fragmentShader:z,transparent:!0}),B=(t,s)=>{const e=new l(t.geometry,T);e.position.set(t.position.x,t.position.y,t.position.z),e.name="city",s.scene.add(e),e.rotateX(-Math.PI/2)},D=(t,s)=>{const e=new f(t.geometry,1),n=new m({color:"rgba(38,133,254)"}),o=new h(e,n);o.position.set(t.position.x,t.position.y,t.position.z),s.scene.add(o),o.rotateX(-Math.PI/2)},F=t=>{const s={camera:{fov:60,near:1,far:1e4,position:{x:600,y:600,z:600}},renderer:{clearAlpha:1,clearColor:"#302E37"}},e=new g(t,s),n=new y([{name:"shanghai",type:"GLTF",show:!0,path:"/gltf/shanghai.gltf"}],"circle");return n.on("ready",()=>{n.items.get("shanghai").scene.traverse(o=>{if(o.isMesh)if(["CITY_UNTRIANGULATED"].includes(o.name)){if(!e)return;D(o,e),B(o,e)}else if(["ROADS"].includes(o.name)){const r=new d({color:"rgb(41,46,76)"}),i=new l(o.geometry,r);if(i.rotateX(-Math.PI/2),i.position.set(o.position.x,o.position.y,o.position.z),!e)return;e.scene.add(i)}else{const r=new d({color:"#040912"}),i=new l(o.geometry,r);if(!e)return;e.scene.add(i),i.rotateX(-Math.PI/2),i.position.set(o.position.x,o.position.y,o.position.z)}})}),e.time.on("tick",()=>{a.height.value+=.2,a.height.value>100&&(a.height.value=0)}),e},A=t=>(I("data-v-4212e54a"),t=t(),P(),t),E={style:{"box-sizing":"border-box"}},b=A(()=>v("div",{style:{position:"absolute",top:"20px",left:"20px",color:"aliceblue","font-size":"20px"}}," threejs路由切换时上一个场景会占用内存,重新刷新即可解决，此问题等待后续版本优化！ ",-1)),k=_({__name:"City",setup(t){const s=p(),e=p();return x(()=>{e.value=F(s.value)}),C(()=>{e.value&&e.value.dispose()}),(n,o)=>(w(),M("div",E,[b,v("canvas",{class:"webgl",ref_key:"canvasDom",ref:s},null,512)]))}});const q=S(k,[["__scopeId","data-v-4212e54a"]]);export{q as default};
