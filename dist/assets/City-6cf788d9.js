import{C as c,h,b as v,d as n,i as g,j as y,k as _}from"./three-003e6fb4.js";import{C as r,T as C}from"./ThreeInstance-b1b8b65a.js";import{d as x,b as d,z as w,A as M,o as P,f as I,g as z}from"./@vue-92cee4ac.js";import{_ as L}from"./index-e9b181a7.js";import"./gsap-89c74157.js";import"./vue-router-95ee3816.js";var T="float distanceTo(vec2 src,vec2 dst){float dx=src.x-dst.x;float dy=src.y-dst.y;float dv=dx*dx+dy*dy;return sqrt(dv);}varying vec3 vPosition;uniform float height;uniform vec3 uFlowColor;uniform vec3 uCityColor;void main(){vec3 distColor=uCityColor;float topY=vPosition.z+10.;if(height>vPosition.z&&height<topY){float dIndex=sin((height-vPosition.z)/10.0*3.14);distColor=mix(uFlowColor,distColor,1.0-dIndex);}vec2 position2D=vec2(vPosition.x,vPosition.y);float Len=distanceTo(position2D,vec2(0,0));if(Len>height*30.0&&Len<(height*30.0+130.0)){float dIndex=sin((Len-height*30.0)/130.0*3.14);distColor=mix(uFlowColor,distColor,1.0-dIndex);}gl_FragColor=vec4(distColor,1.0);}",S="varying vec3 vPosition;void main(){vPosition=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}";const B={style:{"box-sizing":"border-box"}},F=x({__name:"City",setup(D){const l=d(),t=d();r.camera.position={x:600,y:600,z:600},r.sources=[{name:"shanghai",type:"GLTF",show:!0,path:"/gltf/shanghai.gltf"}];const i={height:{value:20},uFlowColor:{value:new c("#5588aa")},uCityColor:{value:new c("#1B3045")}},u=new h({uniforms:i,vertexShader:S,fragmentShader:T,transparent:!0}),m=(e,s)=>{const o=new n(e.geometry,u);o.position.set(e.position.x,e.position.y,e.position.z),o.name="city",s.scene.add(o),o.rotateX(-Math.PI/2)},p=(e,s)=>{const o=new g(e.geometry,1),f=new y({color:"rgba(38,133,254)"}),a=new _(o,f);a.position.set(e.position.x,e.position.y,e.position.z),s.scene.add(a),a.rotateX(-Math.PI/2)};return w(()=>{t.value=new C(l.value,r),t.value.resources.on("ready",()=>{t.value.resources.items.shanghai.scene.traverse(e=>{if(e.isMesh)if(["CITY_UNTRIANGULATED"].includes(e.name))p(e,t.value),m(e,t.value);else if(["ROADS"].includes(e.name)){const s=new v({color:"rgb(41,46,76)"}),o=new n(e.geometry,s);o.rotateX(-Math.PI/2),o.position.set(e.position.x,e.position.y,e.position.z),t.value.scene.add(o)}else{const s=new v({color:"#040912"}),o=new n(e.geometry,s);t.value.scene.add(o),o.rotateX(-Math.PI/2),o.position.set(e.position.x,e.position.y,e.position.z)}})}),t.value.time.on("tick",()=>{i.height.value+=.2,i.height.value>100&&(i.height.value=0)})}),M(()=>{t.value.dispose()}),(e,s)=>(P(),I("div",B,[z("canvas",{class:"webgl",ref_key:"canvasDom",ref:l},null,512)]))}});const O=L(F,[["__scopeId","data-v-a6597814"]]);export{O as default};
